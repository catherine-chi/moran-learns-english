<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Moran Learns English</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #fdf6e3;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    h1 { color: #b58900; margin-bottom: 10px; }
    #loginContainer { display: flex; flex-direction: column; align-items: center; margin-top: 50px; }
    #loginContainer input, #loginContainer button { padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; width: 80%; max-width: 300px; }
    #loginContainer button { background-color: #b58900; color: white; border: none; cursor: pointer; }
    #monthDisplay { font-size: 1.4rem; margin: 20px 0; display:none; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; width: 100%; max-width: 500px; display:none; }
    .weekday { font-weight: bold; text-align: center; padding: 5px; color: #7b3f00; }
    .day { background: #fef6e4; border-radius: 10px; padding: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.1s; }
    .day:hover { transform: scale(1.05); background: #fff2cc; }
    .day-number { font-weight: bold; margin-bottom: 5px; color: #b58900; }
    .progress { margin-top: 20px; font-size: 1.2rem; color: #7b3f00; display:none; }
    #progressBar { margin-top: 10px; width: 100%; max-width: 500px; height: 20px; background: #ddd2b3; border-radius: 10px; overflow: hidden; display:none; }
    #progressFill { height: 100%; background: #b58900; width: 0%; }
</style>
</head>
<body>
<h1>Moran Learns English</h1>

<div id="loginContainer">
    <input type="email" id="emailInput" placeholder="Email" />
    <input type="password" id="passwordInput" placeholder="Password" />
    <button id="loginButton">Login</button>
</div>

<div id="monthDisplay"></div>
<div class="calendar" id="calendar"></div>
<div class="progress" id="progressText"></div>
<div id="progressBar"><div id="progressFill"></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyCblUJbhFIjKXeFKIOzoQKdS-5AP92KHOw",
    authDomain: "moran-learns-english.firebaseapp.com",
    projectId: "moran-learns-english",
    storageBucket: "moran-learns-english.firebasestorage.app",
    messagingSenderId: "236726052976",
    appId: "1:236726052976:web:5666a1010e065dee44ecb5",
    measurementId: "G-Q72265Y0SK"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const loginContainer = document.getElementById("loginContainer");
const emailInput = document.getElementById("emailInput");
const passwordInput = document.getElementById("passwordInput");
const loginButton = document.getElementById("loginButton");
const monthDisplay = document.getElementById("monthDisplay");
const calendar = document.getElementById("calendar");
const progressText = document.getElementById("progressText");
const progressBar = document.getElementById("progressBar");
const progressFill = document.getElementById("progressFill");

const monthlyGoal = 600;
const today = new Date();
const year = today.getFullYear();
const month = today.getMonth();
const daysInMonth = new Date(year, month + 1, 0).getDate();

monthDisplay.innerText = new Date(year, month).toLocaleString('default', { month: 'long', year: 'numeric' });

let vocabLog = {};

loginButton.onclick = () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    signInWithEmailAndPassword(auth, email, password)
        .then(() => renderApp())
        .catch(err => alert(err.message));
};

onAuthStateChanged(auth, user => {
    if(user){
        renderApp();
    } else {
        loginContainer.style.display = "flex";
        monthDisplay.style.display = "none";
        calendar.style.display = "none";
        progressText.style.display = "none";
        progressBar.style.display = "none";
    }
});

function renderApp(){
    loginContainer.style.display = "none";
    monthDisplay.style.display = "block";
    calendar.style.display = "grid";
    progressText.style.display = "block";
    progressBar.style.display = "block";
    loadData();
}

async function loadData() {
    const docRef = doc(db, "vocabLogs", `${year}-${month+1}`);
    const snapshot = await getDoc(docRef);
    vocabLog = snapshot.exists() ? snapshot.data() : {};
    renderCalendar();
    updateProgress();
}

async function saveData() {
    const docRef = doc(db, "vocabLogs", `${year}-${month+1}`);
    await setDoc(docRef, vocabLog);
}

function updateProgress() {
    const total = Object.values(vocabLog).reduce((a, b) => a + b, 0);
    const percent = Math.min((total / monthlyGoal) * 100, 100);
    progressText.innerText = `Progress: ${total} / ${monthlyGoal} words (${percent.toFixed(0)}%)`;
    progressFill.style.width = percent + "%";
}

function renderCalendar() {
    calendar.innerHTML = "";

    const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    weekdays.forEach(day => {
        const header = document.createElement("div");
        header.className = "weekday";
        header.innerText = day;
        calendar.appendChild(header);
    });

    const firstDayOfMonth = new Date(year, month, 1).getDay();
    for(let i=0; i<firstDayOfMonth; i++){
        const empty = document.createElement("div");
        calendar.appendChild(empty);
    }

    for(let day=1; day<=daysInMonth; day++){
        const div = document.createElement("div");
        div.className = "day";
        const amount = vocabLog[day] || 0;
        div.innerHTML = `<div class="day-number">${day}</div><div>${amount} words</div>`;
        div.onclick = async () => {
            const newAmount = parseInt(prompt(`How many words learned on day ${day}?`, amount)) || 0;
            vocabLog[day] = newAmount;
            await saveData();
            renderCalendar();
            updateProgress();
        };
        calendar.appendChild(div);
    }
}
</script>
</body>
</h